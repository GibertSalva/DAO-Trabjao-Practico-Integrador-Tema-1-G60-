{% extends 'reservas/base.html' %}

{% block title %}Detalle de Reserva - Sistema de Reservas{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header d-flex justify-between align-center">
        <h2 class="card-title">📅 Detalles de la Reserva #{{ reserva.id }}</h2>
        <div class="d-flex gap-1">
            <a href="{% url 'reserva_editar' reserva.id %}" class="btn btn-sm btn-warning">✏️ Editar</a>
            <a href="{% url 'reserva_lista' %}" class="btn btn-sm btn-secondary">← Volver</a>
        </div>
    </div>
    
    <!-- Estado de la Reserva -->
    <div style="text-align: center; padding: 1.5rem; margin-bottom: 1.5rem; background-color: #f3f4f6; border-radius: 6px;">
        {% if reserva.estado == 'CONFIRMADA' %}
            <span class="badge badge-success" style="font-size: 1.2rem; padding: 0.75rem 1.5rem;">
                ✓ RESERVA CONFIRMADA
            </span>
        {% elif reserva.estado == 'PENDIENTE' %}
            <span class="badge badge-warning" style="font-size: 1.2rem; padding: 0.75rem 1.5rem;">
                ⏳ RESERVA PENDIENTE
            </span>
        {% else %}
            <span class="badge badge-danger" style="font-size: 1.2rem; padding: 0.75rem 1.5rem;">
                ✗ RESERVA CANCELADA
            </span>
        {% endif %}
    </div>
    
    <!-- Información del Cliente -->
    <div style="background-color: #dbeafe; padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
        <h3 style="color: #1e40af; margin-bottom: 1rem;">👤 Cliente</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            <div>
                <p class="text-muted mb-1">Nombre</p>
                <p style="font-weight: 600;">{{ reserva.cliente.nombre }} {{ reserva.cliente.apellido }}</p>
            </div>
            <div>
                <p class="text-muted mb-1">DNI</p>
                <p style="font-weight: 600;">{{ reserva.cliente.dni }}</p>
            </div>
            <div>
                <p class="text-muted mb-1">Email</p>
                <p style="font-weight: 600;">{{ reserva.cliente.email }}</p>
            </div>
            <div>
                <p class="text-muted mb-1">Teléfono</p>
                <p style="font-weight: 600;">{{ reserva.cliente.telefono }}</p>
            </div>
        </div>
        <a href="{% url 'cliente_detalle' reserva.cliente.id %}" class="btn btn-sm btn-secondary mt-2">
            Ver perfil del cliente
        </a>
    </div>
    
    <!-- Información de la Cancha -->
    <div style="background-color: #d1fae5; padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
        <h3 style="color: #065f46; margin-bottom: 1rem;">🏟️ Cancha</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            <div>
                <p class="text-muted mb-1">Nombre</p>
                <p style="font-weight: 600;">{{ reserva.cancha.nombre }}</p>
            </div>
            <div>
                <p class="text-muted mb-1">Tipo</p>
                <p style="font-weight: 600;">{{ reserva.cancha.tipo_cancha.nombre }}</p>
            </div>
            <div>
                <p class="text-muted mb-1">Precio por Hora</p>
                <p style="font-weight: 600; color: #10b981;">${{ reserva.cancha.precio_por_hora }}</p>
            </div>
        </div>
        <a href="{% url 'cancha_detalle' reserva.cancha.id %}" class="btn btn-sm btn-secondary mt-2">
            Ver detalles de la cancha
        </a>
    </div>
    
    <!-- Horario -->
    <div style="background-color: #fef3c7; padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
        <h3 style="color: #92400e; margin-bottom: 1rem;">⏰ Horario</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            <div>
                <p class="text-muted mb-1">Fecha y Hora de Inicio</p>
                <p style="font-weight: 600; font-size: 1.1rem;">
                    📅 {{ reserva.fecha_hora_inicio|date:"d/m/Y" }} - 🕐 {{ reserva.fecha_hora_inicio|date:"H:i" }}
                </p>
            </div>
            <div>
                <p class="text-muted mb-1">Fecha y Hora de Fin</p>
                <p style="font-weight: 600; font-size: 1.1rem;">
                    📅 {{ reserva.fecha_hora_fin|date:"d/m/Y" }} - 🕐 {{ reserva.fecha_hora_fin|date:"H:i" }}
                </p>
            </div>
            <div>
                <p class="text-muted mb-1">Duración</p>
                {% with duracion=reserva.fecha_hora_fin|timeuntil:reserva.fecha_hora_inicio %}
                <p style="font-weight: 600; font-size: 1.1rem;">⏱️ {{ duracion }}</p>
                {% endwith %}
            </div>
        </div>
    </div>
    
    <!-- Servicios Adicionales -->
    {% if reserva.servicios.all %}
    <div style="background-color: #e0e7ff; padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
        <h3 style="color: #3730a3; margin-bottom: 1rem;">🎯 Servicios Adicionales</h3>
        <ul>
            {% for servicio in reserva.servicios.all %}
            <li style="margin-bottom: 0.5rem;">
                <strong>{{ servicio.nombre }}</strong> - ${{ servicio.costo_adicional }}
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
    
    <!-- Torneo -->
    {% if reserva.torneo %}
    <div style="background-color: #f3e8ff; padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
        <h3 style="color: #6b21a8; margin-bottom: 1rem;">🏆 Torneo</h3>
        <p><strong>{{ reserva.torneo.nombre }}</strong></p>
        <p class="text-muted">
            {{ reserva.torneo.fecha_inicio|date:"d/m/Y" }} - {{ reserva.torneo.fecha_fin|date:"d/m/Y" }}
        </p>
    </div>
    {% endif %}
    
    <!-- Información de Pago -->
    {% if reserva.pago %}
    <div style="background-color: #fee2e2; padding: 1rem; border-radius: 6px;">
        <h3 style="color: #991b1b; margin-bottom: 1rem;">💰 Información de Pago</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            <div>
                <p class="text-muted mb-1">Monto Total</p>
                <p style="font-weight: 700; font-size: 1.5rem; color: #10b981;">
                    ${{ reserva.pago.monto_total }}
                </p>
            </div>
            <div>
                <p class="text-muted mb-1">Estado del Pago</p>
                <p style="font-weight: 600;">
                    {% if reserva.pago.estado == 'PAGADO' %}
                        <span class="badge badge-success">✓ Pagado</span>
                    {% elif reserva.pago.estado == 'PENDIENTE' %}
                        <span class="badge badge-warning">⏳ Pendiente</span>
                    {% else %}
                        <span class="badge badge-info">💸 Reembolsado</span>
                    {% endif %}
                </p>
            </div>
            {% if reserva.pago.metodo_pago %}
            <div>
                <p class="text-muted mb-1">Método de Pago</p>
                <p style="font-weight: 600;">{{ reserva.pago.get_metodo_pago_display }}</p>
            </div>
            {% endif %}
            {% if reserva.pago.fecha_pago %}
            <div>
                <p class="text-muted mb-1">Fecha de Pago</p>
                <p style="font-weight: 600;">{{ reserva.pago.fecha_pago|date:"d/m/Y H:i" }}</p>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
